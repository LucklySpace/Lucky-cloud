# im-live ä¸­å¿ƒåŒ–æµåª’ä½“ç›´æ’­æœåŠ¡

åŸºäº **Netty + im-spring + è™šæ‹Ÿçº¿ç¨‹ï¼ˆJDK 21ï¼‰** çš„é«˜æ€§èƒ½ WebRTC ä¸­å¿ƒåŒ–æµåª’ä½“æœåŠ¡å™¨ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

im-live æ˜¯ä¸€ä¸ªä¸­å¿ƒåŒ–æµåª’ä½“ç›´æ’­æœåŠ¡ï¼Œé‡‡ç”¨ SFUï¼ˆSelective Forwarding Unitï¼‰æ¶æ„æ¨¡å¼ã€‚æ¨æµè€…å°†åª’ä½“æµæ¨é€åˆ°æœåŠ¡å™¨ï¼Œæ‹‰æµè€…ä»æœåŠ¡å™¨è®¢é˜…å¹¶æ‹‰å–æµï¼ŒæœåŠ¡å™¨è´Ÿè´£ä¿¡ä»¤äº¤æ¢å’Œè¿æ¥åè°ƒã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **WebRTC ä¿¡ä»¤äº¤æ¢**ï¼šå®Œæ•´çš„ SDP/ICE é€ä¼ æœºåˆ¶
- âœ… **SFU æ¶æ„**ï¼šæœåŠ¡å™¨ç«¯åª’ä½“è½¬å‘ç®¡ç†
- âœ… **é«˜æ€§èƒ½è®¾è®¡**ï¼šNetty NIO/Epoll + JDK 21 è™šæ‹Ÿçº¿ç¨‹
- âœ… **QoS ç›‘æ§**ï¼šå»¶è¿Ÿç»Ÿè®¡ã€è¿æ¥ç›‘æ§ã€è´¨é‡æŠ¥å‘Š
- âœ… **æˆ¿é—´ç®¡ç†**ï¼šå¤šæˆ¿é—´ã€å¤šç”¨æˆ·ã€å¤šæµæ”¯æŒ
- âœ… **è¿æ¥ç®¡ç†**ï¼šWebRTC è¿æ¥çŠ¶æ€è·Ÿè¸ª
- âœ… **è‡ªåŠ¨æ¸…ç†**ï¼šç©ºé—²æˆ¿é—´/è¶…æ—¶è¿æ¥è‡ªåŠ¨æ¸…ç†

---

## ğŸ“ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚         im-live æœåŠ¡å™¨               â”‚
                              â”‚                                     â”‚
   æ¨æµè€… A â”€â”€â”€WebSocketâ”€â”€â”€â”€â–ºâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                              â”‚  â”‚      SignalDispatcher       â”‚   â”‚â—„â”€â”€â”€â”€WebSocketâ”€â”€â”€â”€ æ‹‰æµè€… 1
                              â”‚  â”‚      (ä¿¡ä»¤åˆ†å‘å™¨)            â”‚   â”‚
   æ¨æµè€… B â”€â”€â”€WebSocketâ”€â”€â”€â”€â–ºâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â—„â”€â”€â”€â”€WebSocketâ”€â”€â”€â”€ æ‹‰æµè€… 2
                              â”‚              â”‚                     â”‚
                              â”‚              â–¼                     â”‚
                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â—„â”€â”€â”€â”€WebSocketâ”€â”€â”€â”€ æ‹‰æµè€… 3
                              â”‚  â”‚      MediaForwarder         â”‚   â”‚
                              â”‚  â”‚      (SFU åª’ä½“è½¬å‘å™¨)        â”‚   â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â”‚              â”‚                     â”‚
                              â”‚              â–¼                     â”‚
                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                              â”‚  â”‚    ConnectionManager        â”‚   â”‚
                              â”‚  â”‚    (è¿æ¥ç®¡ç†å™¨)              â”‚   â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â”‚              â”‚                     â”‚
                              â”‚              â–¼                     â”‚
                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                              â”‚  â”‚       QosMonitor            â”‚   â”‚
                              â”‚  â”‚       (è´¨é‡ç›‘æ§)             â”‚   â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                   â”‚ â”‚                   â”‚
                        â–¼                   â–¼ â–¼                   â–¼
                   RoomManager         StreamManager          è™šæ‹Ÿçº¿ç¨‹æ± 
                   (æˆ¿é—´ç®¡ç†)          (æµç®¡ç†)              (ä¸šåŠ¡å¤„ç†)
```

### ä»£ç ç»“æ„

```
im-live/src/main/java/com/xy/lucky/live/
â”œâ”€â”€ ImLiveApplication.java           # åº”ç”¨å…¥å£
â”œâ”€â”€ config/
â”‚   â””â”€â”€ LiveProperties.java          # é…ç½®å±æ€§ç±»
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”œâ”€â”€ LiveRoom.java            # ç›´æ’­æˆ¿é—´å®ä½“
â”‚   â”‚   â”œâ”€â”€ LiveUser.java            # ç”¨æˆ·å®ä½“
â”‚   â”‚   â””â”€â”€ LiveStream.java          # æµå®ä½“
â”‚   â”œâ”€â”€ RoomManager.java             # æˆ¿é—´ç®¡ç†å™¨
â”‚   â”œâ”€â”€ StreamManager.java           # æµç®¡ç†å™¨
â”‚   â””â”€â”€ sfu/                         # SFU æ ¸å¿ƒæ¨¡å—
â”‚       â”œâ”€â”€ MediaForwarder.java      # åª’ä½“è½¬å‘ç®¡ç†å™¨
â”‚       â”œâ”€â”€ ForwardingSession.java   # è½¬å‘ä¼šè¯
â”‚       â”œâ”€â”€ SubscriberInfo.java      # è®¢é˜…è€…ä¿¡æ¯
â”‚       â”œâ”€â”€ ConnectionManager.java   # WebRTC è¿æ¥ç®¡ç†å™¨
â”‚       â””â”€â”€ QosMonitor.java          # QoS è´¨é‡ç›‘æ§å™¨
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ SignalingServer.java         # Netty ä¿¡ä»¤æœåŠ¡å™¨
â”‚   â”œâ”€â”€ WebSocketHandler.java        # WebSocket å¤„ç†å™¨
â”‚   â””â”€â”€ WebSocketInitializer.java    # Channel åˆå§‹åŒ–å™¨
â”œâ”€â”€ signal/
â”‚   â”œâ”€â”€ SignalDispatcher.java        # ä¿¡ä»¤åˆ†å‘å™¨
â”‚   â””â”€â”€ message/
â”‚       â”œâ”€â”€ SignalMessage.java       # ä¿¡ä»¤æ¶ˆæ¯
â”‚       â”œâ”€â”€ MessageType.java         # æ¶ˆæ¯ç±»å‹å¸¸é‡
â”‚       â””â”€â”€ ErrorCode.java           # é”™è¯¯ç å¸¸é‡
â””â”€â”€ runner/
    â””â”€â”€ LiveServerRunner.java        # å¯åŠ¨ Runner
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

| ç»„ä»¶                  | èŒè´£                                |
|---------------------|-----------------------------------|
| `SignalingServer`   | åŸºäº Netty çš„ WebSocket æœåŠ¡å™¨ï¼Œå¤„ç†ç½‘ç»œ I/O |
| `SignalDispatcher`  | ä¿¡ä»¤æ¶ˆæ¯è§£æå’Œåˆ†å‘ï¼Œåè°ƒå„ç»„ä»¶                   |
| `MediaForwarder`    | SFU æ ¸å¿ƒï¼Œç®¡ç†æµçš„è½¬å‘ä¼šè¯å’Œè®¢é˜…å…³ç³»              |
| `ConnectionManager` | è·Ÿè¸ª WebRTC è¿æ¥çŠ¶æ€ï¼Œå¤„ç† Trickle ICE     |
| `QosMonitor`        | æ”¶é›† QoS æŒ‡æ ‡ï¼Œç›‘æ§æœåŠ¡å¥åº·çŠ¶æ€                |
| `RoomManager`       | æˆ¿é—´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œç”¨æˆ·åŠ å…¥/ç¦»å¼€                  |
| `StreamManager`     | æµçš„å‘å¸ƒ/è®¢é˜…/å–æ¶ˆç®¡ç†                      |

---

## ğŸ”„ å·¥ä½œæµç¨‹

### æ¨æµæµç¨‹

```
æ¨æµè€…                      æœåŠ¡å™¨                        å…¶ä»–ç”¨æˆ·
  â”‚                          â”‚                              â”‚
  â”‚â”€â”€â”€â”€ join â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚
  â”‚â—„â”€â”€â”€ joined â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
  â”‚                          â”‚                              â”‚
  â”‚â”€â”€â”€â”€ publish â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ åˆ›å»º ForwardingSession       â”‚
  â”‚â—„â”€â”€â”€ published â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
  â”‚                          â”‚â”€â”€â”€â”€ stream_published â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                          â”‚                              â”‚
```

### æ‹‰æµæµç¨‹

```
æ¨æµè€…                      æœåŠ¡å™¨                       æ‹‰æµè€…
  â”‚                          â”‚                              â”‚
  â”‚                          â”‚â—„â”€â”€â”€ subscribe â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                          â”‚ è®°å½•è®¢é˜…å…³ç³»                   â”‚
  â”‚                          â”‚ åˆ›å»º Connection               â”‚
  â”‚                          â”‚â”€â”€â”€â”€ subscribed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                          â”‚                              â”‚
  â”‚                          â”‚â—„â”€â”€â”€ offer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚â—„â”€â”€â”€ offer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ æ›´æ–°è¿æ¥çŠ¶æ€                  â”‚
  â”‚                          â”‚                              â”‚
  â”‚â”€â”€â”€â”€ answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚
  â”‚                          â”‚â”€â”€â”€â”€ answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                          â”‚                              â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ candidate äº¤æ¢ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                          â”‚                              â”‚
  â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â• WebRTC P2P åª’ä½“æµ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### application.yml

```yaml
app:
   name: im-live
   version: 1.0.0

spring:
   profiles:
      active: dev

live:
   # ä¿¡ä»¤æœåŠ¡å™¨é…ç½®
  signaling:
     port: 8082                    # WebSocket ç«¯å£
     path: /ws                     # WebSocket è·¯å¾„
     ssl: false                    # æ˜¯å¦å¯ç”¨ SSL
     heartbeatInterval: 30000      # å¿ƒè·³é—´éš”ï¼ˆæ¯«ç§’ï¼‰
     heartbeatTimeout: 90000       # å¿ƒè·³è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
     maxFrameSize: 65536           # æœ€å¤§å¸§å¤§å°

   # ICE æœåŠ¡å™¨é…ç½®
  ice:
     stunServers:
        - stun:stun.l.google.com:19302
        - stun:stun1.l.google.com:19302
     turnServers: [ ]               # TURN æœåŠ¡å™¨åˆ—è¡¨
     gatheringTimeout: 10000       # ICE æ”¶é›†è¶…æ—¶

   # æˆ¿é—´é…ç½®
  room:
     maxUsersPerRoom: 100          # å•æˆ¿é—´æœ€å¤§ç”¨æˆ·æ•°
     maxPublishersPerRoom: 10      # å•æˆ¿é—´æœ€å¤§æ¨æµæ•°
     idleTimeout: 300000           # ç©ºé—²è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
     allowAnonymous: true          # æ˜¯å¦å…è®¸åŒ¿å

   # æ€§èƒ½é…ç½®
  performance:
     bossThreads: 1                # Boss çº¿ç¨‹æ•°
     workerThreads: 0              # Worker çº¿ç¨‹æ•°ï¼ˆ0=è‡ªåŠ¨ï¼‰
     useVirtualThreads: true       # ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹
     virtualThreadNamePrefix: live-vt-
     backlog: 1024                 # è¿æ¥é˜Ÿåˆ—å¤§å°
     preferEpoll: true             # ä¼˜å…ˆä½¿ç”¨ Epoll
```

---

## ğŸ“¡ ä¿¡ä»¤åè®®

### æ¶ˆæ¯æ ¼å¼

```json
{
   "type": "æ¶ˆæ¯ç±»å‹",
   "roomId": "æˆ¿é—´ID",
   "userId": "ç”¨æˆ·ID",
   "targetId": "ç›®æ ‡ç”¨æˆ·ID",
   "streamId": "æµID",
   "sdp": "SDPä¿¡æ¯",
   "candidate": "ICE Candidate",
   "data": "é™„åŠ æ•°æ®",
   "code": "å“åº”ç ",
   "message": "å“åº”ä¿¡æ¯",
   "timestamp": "æ—¶é—´æˆ³"
}
```

### æ¶ˆæ¯ç±»å‹

#### è¿æ¥ç®¡ç†

| ç±»å‹          | æ–¹å‘    | è¯´æ˜   |
|-------------|-------|------|
| `heartbeat` | C â†’ S | å¿ƒè·³è¯·æ±‚ |
| `pong`      | S â†’ C | å¿ƒè·³å“åº” |

#### æˆ¿é—´ç®¡ç†

| ç±»å‹            | æ–¹å‘    | è¯´æ˜                   |
|---------------|-------|----------------------|
| `join`        | C â†’ S | åŠ å…¥æˆ¿é—´                 |
| `joined`      | S â†’ C | åŠ å…¥æˆåŠŸï¼ˆå« ICE é…ç½®å’Œç°æœ‰æµåˆ—è¡¨ï¼‰ |
| `leave`       | C â†’ S | ç¦»å¼€æˆ¿é—´                 |
| `left`        | S â†’ C | ç¦»å¼€æˆåŠŸ                 |
| `user_joined` | S â†’ C | ç”¨æˆ·åŠ å…¥å¹¿æ’­               |
| `user_left`   | S â†’ C | ç”¨æˆ·ç¦»å¼€å¹¿æ’­               |
| `room_info`   | åŒå‘    | æˆ¿é—´ä¿¡æ¯                 |

#### æ¨æ‹‰æµç®¡ç†

| ç±»å‹                   | æ–¹å‘    | è¯´æ˜            |
|----------------------|-------|---------------|
| `publish`            | C â†’ S | å‘å¸ƒæµ           |
| `published`          | S â†’ C | å‘å¸ƒæˆåŠŸ          |
| `unpublish`          | C â†’ S | åœæ­¢å‘å¸ƒ          |
| `unpublished`        | S â†’ C | åœæ­¢æˆåŠŸ          |
| `subscribe`          | C â†’ S | è®¢é˜…æµ           |
| `subscribed`         | S â†’ C | è®¢é˜…æˆåŠŸï¼ˆå«æ¨æµè€… IDï¼‰ |
| `unsubscribe`        | C â†’ S | å–æ¶ˆè®¢é˜…          |
| `stream_published`   | S â†’ C | æ–°æµå¹¿æ’­          |
| `stream_unpublished` | S â†’ C | æµåœæ­¢å¹¿æ’­         |

#### WebRTC ä¿¡ä»¤

| ç±»å‹                 | æ–¹å‘        | è¯´æ˜               |
|--------------------|-----------|------------------|
| `offer`            | C â†’ S â†’ C | SDP Offer è½¬å‘     |
| `answer`           | C â†’ S â†’ C | SDP Answer è½¬å‘    |
| `candidate`        | C â†’ S â†’ C | ICE Candidate è½¬å‘ |
| `connection_state` | C â†’ S     | è¿æ¥çŠ¶æ€æŠ¥å‘Š           |

#### ç»Ÿè®¡ä¸ç›‘æ§

| ç±»å‹               | æ–¹å‘    | è¯´æ˜      |
|------------------|-------|---------|
| `stats`          | åŒå‘    | æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯ |
| `quality_report` | C â†’ S | è´¨é‡æŠ¥å‘Š    |

---

## ğŸ”„ ä½¿ç”¨ç¤ºä¾‹

### 1. åŠ å…¥æˆ¿é—´

**è¯·æ±‚ï¼š**

```json
{
   "type": "join",
   "roomId": "live-room-1",
   "userId": "user_abc123",
   "data": {
      "name": "å¼ ä¸‰"
   }
}
```

**å“åº”ï¼š**

```json
{
   "type": "joined",
   "roomId": "live-room-1",
   "userId": "user_abc123",
   "code": 0,
   "message": "åŠ å…¥æˆ¿é—´æˆåŠŸ",
   "data": {
      "room": {
         "roomId": "live-room-1",
         "userCount": 3,
         "streamCount": 1
      },
      "iceServers": [
         {
            "urls": [
               "stun:stun.l.google.com:19302"
            ]
         }
      ],
      "streams": [
         {
            "streamId": "stream_xyz",
            "publisherId": "user_host",
            "hasAudio": true,
            "hasVideo": true
         }
      ]
   },
   "timestamp": 1704700800000
}
```

### 2. å‘å¸ƒæµ

**è¯·æ±‚ï¼š**

```json
{
   "type": "publish",
   "roomId": "live-room-1",
   "userId": "user_abc123",
   "streamId": "my-stream-1",
   "data": {
      "name": "æˆ‘çš„ç›´æ’­",
      "type": "CAMERA",
      "hasAudio": true,
      "hasVideo": true
   }
}
```

**å“åº”ï¼š**

```json
{
   "type": "published",
   "roomId": "live-room-1",
   "userId": "user_abc123",
   "streamId": "my-stream-1",
   "code": 0,
   "message": "å‘å¸ƒæˆåŠŸ",
   "data": {
      "streamId": "my-stream-1",
      "publisherId": "user_abc123",
      "type": "CAMERA",
      "hasAudio": true,
      "hasVideo": true
   }
}
```

### 3. è®¢é˜…æµ

**è¯·æ±‚ï¼š**

```json
{
   "type": "subscribe",
   "roomId": "live-room-1",
   "userId": "user_viewer",
   "streamId": "my-stream-1"
}
```

**å“åº”ï¼š**

```json
{
   "type": "subscribed",
   "roomId": "live-room-1",
   "userId": "user_viewer",
   "streamId": "my-stream-1",
   "code": 0,
   "message": "è®¢é˜…æˆåŠŸ",
   "data": {
      "stream": {
         ...
      },
      "publisherId": "user_abc123"
   }
}
```

### 4. ä¿¡ä»¤äº¤æ¢ï¼ˆOffer/Answer/Candidateï¼‰

```json
// è®¢é˜…è€…å‘é€ Offer
{
   "type": "offer",
   "roomId": "live-room-1",
   "userId": "user_viewer",
   "targetId": "user_abc123",
   "streamId": "my-stream-1",
   "sdp": {
      "type": "offer",
      "sdp": "v=0\r\no=- 123456789 2 IN IP4 127.0.0.1\r\n..."
   }
}

// æ¨æµè€…å›å¤ Answer
{
   "type": "answer",
   "roomId": "live-room-1",
   "userId": "user_abc123",
   "targetId": "user_viewer",
   "streamId": "my-stream-1",
   "sdp": {
      "type": "answer",
      "sdp": "v=0\r\no=- 987654321 2 IN IP4 127.0.0.1\r\n..."
   }
}

// ICE Candidate äº¤æ¢
{
   "type": "candidate",
   "roomId": "live-room-1",
   "userId": "user_viewer",
   "targetId": "user_abc123",
   "streamId": "my-stream-1",
   "candidate": {
      "candidate": "candidate:1 1 UDP 2013266431 192.168.1.100 50000 typ host",
      "sdpMid": "0",
      "sdpMLineIndex": 0
   }
}
```

---

## ğŸ“Š é”™è¯¯ç 

| é”™è¯¯ç   | è¯´æ˜      |
|------|---------|
| 0    | æˆåŠŸ      |
| 1000 | æœªçŸ¥é”™è¯¯    |
| 1001 | å‚æ•°é”™è¯¯    |
| 1002 | æ¶ˆæ¯æ ¼å¼é”™è¯¯  |
| 1003 | æœªæˆæƒ     |
| 1004 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 1005 | æ“ä½œè¶…æ—¶    |
| 2000 | æˆ¿é—´ä¸å­˜åœ¨   |
| 2001 | æˆ¿é—´å·²æ»¡    |
| 2002 | å·²åœ¨æˆ¿é—´ä¸­   |
| 2003 | ä¸åœ¨æˆ¿é—´ä¸­   |
| 3000 | ç”¨æˆ·ä¸å­˜åœ¨   |
| 4000 | æµä¸å­˜åœ¨    |
| 4001 | æµå·²å­˜åœ¨    |
| 4002 | æ¨æµæ•°é‡è¶…é™  |
| 5003 | ç›®æ ‡ç”¨æˆ·ä¸å¯è¾¾ |

---

## ğŸƒ å¯åŠ¨ä¸æµ‹è¯•

### 1. ç¼–è¯‘æ‰“åŒ…

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
mvn -q -DskipTests package
```

### 2. è¿è¡ŒæœåŠ¡

```bash
java -jar im-live/target/im-live-0.0.1-SNAPSHOT.jar
```

### 3. æµ‹è¯•é¡µé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—® `src/main/resources/static/index.html`ï¼š

1. **è¿æ¥**ï¼šç‚¹å‡»ã€Œè¿æ¥ã€æŒ‰é’®è¿æ¥ä¿¡ä»¤æœåŠ¡å™¨
2. **åŠ å…¥æˆ¿é—´**ï¼šè¾“å…¥æˆ¿é—´ IDï¼Œç‚¹å‡»ã€ŒåŠ å…¥æˆ¿é—´ã€
3. **æ¨æµ**ï¼šé€‰æ‹©è§†é¢‘æºï¼ˆæ‘„åƒå¤´/å±å¹•ï¼‰ï¼Œç‚¹å‡»ã€Œå¼€å§‹æ¨æµã€
4. **æ‹‰æµ**ï¼šåœ¨å¦ä¸€ä¸ªæµè§ˆå™¨çª—å£åŠ å…¥åŒä¸€æˆ¿é—´ï¼Œåœ¨æµåˆ—è¡¨ä¸­ç‚¹å‡»ã€Œè®¢é˜…ã€

### WebSocket åœ°å€

```
ws://localhost:8082/ws
```

---

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### å¹¶å‘æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®¢æˆ·ç«¯ WebSocket è¿æ¥                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Netty EventLoopï¼ˆNIO/Epollï¼‰                    â”‚
â”‚                    é«˜æ€§èƒ½ç½‘ç»œ I/O å¤„ç†                        â”‚
â”‚                    Boss: 1 çº¿ç¨‹ï¼ˆæ¥æ”¶è¿æ¥ï¼‰                    â”‚
â”‚                    Worker: CPU*2 çº¿ç¨‹ï¼ˆå¤„ç† I/Oï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JDK 21 è™šæ‹Ÿçº¿ç¨‹æ‰§è¡Œå™¨                      â”‚
â”‚                å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œé¿å…é˜»å¡ EventLoop               â”‚
â”‚                    æ¯ä¸ªè¯·æ±‚ä¸€ä¸ªè™šæ‹Ÿçº¿ç¨‹                        â”‚
â”‚                    è½»é‡çº§ã€é«˜å¹¶å‘ã€ä½å»¶è¿Ÿ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼               â–¼               â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚RoomManagerâ”‚   â”‚MediaFwd   â”‚   â”‚QosMonitor â”‚
       â”‚ æˆ¿é—´ç®¡ç†   â”‚   â”‚ SFUè½¬å‘   â”‚   â”‚ è´¨é‡ç›‘æ§  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¼˜åŒ–ç­–ç•¥

1. **ç½‘ç»œå±‚**
   - Netty NIO/Epoll å¤šè·¯å¤ç”¨
   - æ± åŒ– ByteBuf å‡å°‘ GC
   - TCP_NODELAY é™ä½å»¶è¿Ÿ
   - SO_BACKLOG é˜Ÿåˆ—ä¼˜åŒ–

2. **ä¸šåŠ¡å±‚**
   - è™šæ‹Ÿçº¿ç¨‹å¤„ç†ä¸šåŠ¡é€»è¾‘
   - ConcurrentHashMap æ— é”æ•°æ®ç»“æ„
   - ChannelGroup é«˜æ•ˆå¹¿æ’­

3. **ç›‘æ§å±‚**
   - å®æ—¶å»¶è¿Ÿç»Ÿè®¡
   - è¿æ¥æˆåŠŸç‡ç›‘æ§
   - è‡ªåŠ¨æ¸…ç†è¶…æ—¶èµ„æº

---

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

QosMonitor æ”¶é›†çš„æŒ‡æ ‡ï¼š

| ç±»åˆ« | æŒ‡æ ‡                | è¯´æ˜     |
|----|-------------------|--------|
| å»¶è¿Ÿ | latencyAvg        | å¹³å‡ä¿¡ä»¤å»¶è¿Ÿ |
| å»¶è¿Ÿ | latencyMax        | æœ€å¤§å»¶è¿Ÿ   |
| å»¶è¿Ÿ | latencyP99        | P99 å»¶è¿Ÿ |
| æµé‡ | qps               | æ¯ç§’è¯·æ±‚æ•°  |
| æµé‡ | totalMessages     | æ€»æ¶ˆæ¯æ•°   |
| ä¸šåŠ¡ | totalJoins        | åŠ å…¥æˆ¿é—´æ¬¡æ•° |
| ä¸šåŠ¡ | totalPublishes    | å‘å¸ƒæµæ¬¡æ•°  |
| ä¸šåŠ¡ | totalSubscribes   | è®¢é˜…æµæ¬¡æ•°  |
| è¿æ¥ | activeConnections | æ´»è·ƒè¿æ¥æ•°  |
| è¿æ¥ | peakConnections   | å³°å€¼è¿æ¥æ•°  |
| è¿æ¥ | successRate       | è¿æ¥æˆåŠŸç‡  |

---

## ğŸš€ æ‰©å±•å»ºè®®

1. **è®¤è¯æˆæƒ**ï¼šé›†æˆ JWT Token éªŒè¯
2. **é›†ç¾¤éƒ¨ç½²**ï¼šä½¿ç”¨ Redis å…±äº«ä¼šè¯çŠ¶æ€
3. **åª’ä½“å½•åˆ¶**ï¼šé›†æˆå½•åˆ¶æœåŠ¡
4. **CDN åˆ†å‘**ï¼šHLS/DASH è½¬ç åˆ‡ç‰‡
5. **SFU å¢å¼º**ï¼šå¼•å…¥ Janus/mediasoup åšåª’ä½“ä¸­è½¬
6. **ç›‘æ§å‘Šè­¦**ï¼šæ¥å…¥ Prometheus + Grafana

---

## ğŸ“„ License

MIT License
